# Claude Chat Desktop App

TkinterとClaude APIを使用したデスクトップチャットアプリケーションです。シンプル版・画像対応版・会話履歴対応版（マルチターン）・画像対応版（マルチターン）の4つのバージョンがあります。

## アプリケーション一覧

### 1. シンプル版 (`claude_tk_app_simple.py`)
テキストのみの質問・回答ができる基本的なチャットアプリです。

**機能:**
- 画面左半分に質問入力欄
- 画面右半分に回答表示欄
- 「質問を送信する」ボタンでAPI経由で回答を取得
- 「新しい質問をする」ボタンで質問・回答欄をリセット
- 「終了する」ボタンでアプリケーションを終了
- **Markdown変換機能**: Claudeからのmarkdown形式の回答を読みやすいプレーンテキストに自動変換
- **Ctrl+Enter**で質問送信
- .env未設定やAPIキー未設定時はエラー表示してアプリ終了

### 2. 画像対応版 (`claude_tk_app_image.py`)
画像を添付して質問できる高度なチャットアプリです。

**機能:**
- シンプル版の全機能
- 画像選択・プレビュー機能（最大200x200pxで表示）
- 画像付き質問対応（マルチモーダル）
- 対応画像形式: PNG、JPG、JPEG、GIF、BMP、WebP
- 画像はbase64エンコードでAPI送信、MIMEタイプ自動判定
- 画像プレビュー表示（サムネイル）
- 画像削除機能
- **Ctrl+Enter**で質問送信
- .env未設定やAPIキー未設定時はエラー表示してアプリ終了

### 3. 会話履歴・マルチターン版 (`claude_tk_app_multi.py`)
複数回の質問・回答を会話履歴として保持し、文脈を維持したままやりとりできるチャットアプリです。

**機能:**
- 画面左半分に質問入力欄と最新回答欄
- 画面右半分に会話履歴表示欄（質問・回答ペアごとに番号付きで表示、色分け）
- 履歴の保存（Markdown/JSON/両方）
- 履歴のインポート（JSON）で会話を再開
- 「会話をクリア」「会話を再開」ボタン
- **Ctrl+Enter**で質問送信

### 4. マルチターン＋画像対応版 (`claude_tk_app_multi_image.py`)
画像添付と会話履歴（マルチターン）を両立した最上位版です。

**機能:**
- 画面左半分：画像選択・プレビュー・質問入力欄
- 画面右半分：会話履歴表示欄（質問・回答ペアごとに番号付き、画像添付時は実際の画像サムネイルも表示、色分け）
- 画像付き質問を何度でも投稿可能（API仕様上、直近の画像のみ文脈に反映）
- 履歴の保存（Markdown/JSON/両方、画像も含めてzip化）
- 履歴のインポート（zip）で会話を再開（画像も自動復元）
- 「会話をクリア」「会話を再開」ボタン
- **Ctrl+Enter**で質問送信
- .env未設定やAPIキー未設定時はエラー表示してアプリ終了

## 起動方法

1. 必要な依存関係をインストール:
```bash
pip install -r requirements.txt
```

2. `.env`ファイルを作成し、Anthropic APIキーを設定:
```
ANTHROPIC_API_KEY=your_actual_api_key_here
```

3. アプリケーションを実行:

**シンプル版:**
```bash
python claude_tk_app_simple.py
```

**画像対応版:**
```bash
python claude_tk_app_image.py
```

**会話履歴・マルチターン版:**
```bash
python claude_tk_app_multi.py
```

**マルチターン＋画像対応版:**
```bash
python claude_tk_app_multi_image.py
```

## 各バージョンの違い
| ファイル名 | テキスト | 画像添付 | 会話履歴 | 履歴保存/再開 |
|:---|:---:|:---:|:---:|:---:|
| claude_tk_app_simple.py | ○ | × | × | × |
| claude_tk_app_image.py | ○ | ○ | × | × |
| claude_tk_app_multi.py | ○ | × | ○ | ○ |
| claude_tk_app_multi_image.py | ○ | ○ | ○ | ○ |

## 使用方法

### シンプル版
1. アプリケーションを起動
2. 左側の質問欄に質問を入力
3. 「質問を送信する」ボタンまたはCtrl+Enterで送信
4. 右側の回答欄にClaudeからの回答が表示されます
5. 「新しい質問をする」ボタンで新しい質問を開始
6. 「終了する」ボタンでアプリケーションを終了

### 画像対応版
1. アプリケーションを起動
2. 「画像を選択」ボタンで画像を選択（オプション）
3. 左側の質問欄に質問を入力
4. 「質問を送信する」ボタンまたはCtrl+Enterで送信
5. 右側の回答欄にClaudeからの回答が表示されます
6. 「新しい質問をする」ボタンで新しい質問を開始（画像もリセット）
7. 「終了する」ボタンでアプリケーションを終了

### 会話履歴・マルチターン版
1. アプリケーションを起動
2. 左側の「新しい質問」欄に質問を入力
3. 「質問を送信する」ボタンまたはCtrl+Enterで送信
4. 右側の会話履歴欄に【質問 n】【回答 n】のペアで履歴が追加されます（色分け表示）
5. 左下の「最新の回答」欄にも直近の回答が表示されます
6. 「会話をクリア」ボタンで履歴・入力欄・最新回答欄をリセット
7. 「会話を再開」ボタンでJSONファイルから会話履歴をインポートし、続きから会話できます
8. 「終了する」ボタンでアプリケーションを終了

### マルチターン＋画像対応版
1. アプリケーションを起動
2. 左側の「画像を選択」ボタンで画像を選択（オプション）
3. 質問欄に質問を入力
4. 「質問を送信する」ボタンまたはCtrl+Enterで送信
5. 右側の会話履歴欄に【質問 n】【回答 n】のペアで履歴が追加されます（画像添付時はファイル名も表示、色分け）
6. 「会話をクリア」ボタンで履歴・入力欄・画像プレビューをリセット
7. 「会話を再開」ボタンでJSONファイルから会話履歴をインポートし、続きから会話できます
8. 「終了する」ボタンでアプリケーションを終了

## Markdown変換機能

アプリケーションは以下のmarkdown要素を自動的にプレーンテキストに変換します：

- **見出し**: `# タイトル` → `タイトル`
- **太字**: `**太字**` → `太字`
- **斜体**: `*斜体*` → `斜体`
- **コードブロック**: ```` ```code``` ` → `code`
- **インラインコード**: `` `code` `` → `code`
- **リスト**: `- 項目` や `* 項目` → `・項目`
- **リンク**: `[テキスト](URL)` → `テキスト`
- **段落**: 適切な改行で区切られたテキスト

## 使用モデル

- **シンプル版**: claude-sonnet-4-20250514
- **画像対応版**: claude-sonnet-4-20250514
- **会話履歴対応版（マルチターン）**: claude-sonnet-4-20250514
- **画像対応版（マルチターン）**: claude-sonnet-4-20250514

## 依存パッケージ（requirements.txtより）

- anthropic==0.57.1
- python-dotenv==1.1.1
- markdown==3.7
- Pillow==10.4.0

## 注意事項

- Anthropic APIキーが必要です（.envファイルに設定）
- .envファイルやAPIキー未設定時はアプリが起動しません
- インターネット接続が必要です
- シンプル版・画像対応版は質問1回につき回答1回の形式です
- 会話履歴対応版（マルチターン）、画像対応版（マルチターン）は過去の会話文脈を維持します
- Anthropic公式Pythonライブラリを使用
- Markdown変換には`markdown`ライブラリを使用
- 画像対応版には`Pillow`ライブラリが必要
- すべてのバージョンでCtrl+Enterで質問送信可能
- 注意: Markdownの表や複雑なコードブロックは正しく表示されない場合があります（テキスト変換の都合上）。

## 会話履歴の保存・復元（画像・Markdown・zip対応）

### 保存形式
- **Markdown**: 質問・回答ペアをMarkdown形式で保存。添付画像は`img/`フォルダにコピーされ、Markdown内で`img/ファイル名`として参照されます。
- **JSON**: 会話履歴と添付画像をセットでzipファイルに保存。zip内はJSONファイルと`img/`フォルダ（画像格納）で構成。
- **両方**: Markdown+img/とJSON+img/をそれぞれzipで保存。ファイル名が重複しないよう自動で区別されます。

### 保存手順
1. 「会話履歴の保存」ダイアログで保存形式（Markdown/JSON/両方）を選択
2. zipファイルとして保存（Markdownの場合もimg/とセットでzip化）
3. zipを展開すると、Markdownファイルとimg/フォルダ、またはJSONファイルとimg/フォルダが同じディレクトリに揃います
4. Markdownを開くと、img/内の画像が正しく表示されます

### 復元手順
1. 「会話を再開」ボタンでzipファイルを選択
2. zip内のJSONとimg/が自動的に展開され、画像も含めて会話履歴が復元されます
3. 復元後も画像サムネイルが履歴欄に表示されます

### 注意点
- zipから復元した画像はアプリ終了まで一時ディレクトリに保持されます
- Markdownで保存したzipを他のPCや環境に移す場合は、img/フォルダごと展開してMarkdownと同じディレクトリで開いてください
- 両方保存時はファイル名が自動で区別されます（例: `_json.zip`, `_md.zip`） 