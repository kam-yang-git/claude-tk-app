# Claude Chat Desktop App

TkinterとClaude APIを使用したデスクトップチャットアプリケーションです。シンプル版と画像対応版、会話履歴対応版（マルチターン）の3つのバージョンがあります。

## アプリケーション一覧

### 1. シンプル版 (`claude_tk_app_simple.py`)
テキストのみの質問・回答ができる基本的なチャットアプリです。

**機能:**
- 画面左半分に質問入力欄
- 画面右半分に回答表示欄
- 「質問を送信する」ボタンでAPI経由で回答を取得
- 「新しい質問をする」ボタンで質問・回答欄をリセット
- 「終了する」ボタンでアプリケーションを終了
- **Markdown変換機能**: Claudeからのmarkdown形式の回答を読みやすいプレーンテキストに自動変換

### 2. 画像対応版 (`claude_tk_app_image.py`)
画像を添付して質問できる高度なチャットアプリです。

**機能:**
- シンプル版の全機能
- 画像選択・プレビュー機能
- 画像付き質問対応（マルチモーダル）
- 対応画像形式: PNG、JPG、JPEG、GIF、BMP、WebP
- 画像プレビュー表示（サムネイル）
- 画像削除機能

### 3. 会話履歴・マルチターン版 (`claude_tk_app_multi.py`)
複数回の質問・回答を会話履歴として保持し、文脈を維持したままやりとりできるチャットアプリです。

**機能:**
- 画面左半分に質問入力欄と最新回答欄
- 画面右半分に会話履歴表示欄（質問・回答ペアごとに番号付きで表示）
- 「質問を送信する」ボタンでAPI経由で回答を取得し、履歴に追加
- 「会話をクリア」ボタンで履歴・入力欄・最新回答欄をリセット
- 「終了する」ボタンでアプリケーションを終了
- **Markdown変換機能**: 箇条書き（- や * で始まるもの）も「・」で表示
- **Ctrl+Enter**で質問送信
- 過去の会話履歴を文脈としてAPIに送信し、継続的な会話が可能
- **会話履歴の保存機能**: 終了時や会話クリア時に履歴があれば、保存するかどうかを確認。保存する場合はファイル名・保存先を指定可能（JSON形式で保存）。

### 会話履歴の保存機能（マルチターン版のみ）

- 「終了する」または「会話をクリア」時に、会話履歴が残っている場合は保存確認ダイアログが表示されます。
    - 「はい」: 保存形式選択ダイアログが開き、以下から選べます：
        - **Markdown形式で保存**（人が読む用）
        - **JSON形式で保存**（会話再開用、assistantはMarkdownのまま）
        - **両方保存**（両方のファイルを保存）
    - 「いいえ」: 保存せずに終了/クリアします。
    - 「キャンセル」: 操作をキャンセルします。
- 保存ファイルはUTF-8で出力されます。

#### 保存ファイル例

**Markdown形式例**
```
## 質問1
Pythonでリストを逆順にするには？

## 回答1
Pythonでリストを逆順にするには、`reverse()`メソッドやスライスを使います。

```python
list1 = [1, 2, 3]
list1.reverse()
print(list1)  # [3, 2, 1]
```

## 質問2
...
```

**JSON形式例（assistantはMarkdownのまま）**
```json
{
  "metadata": {
    "created_at": "2024-06-07T12:34:56.789012",
    "model": "claude-sonnet-4-20250514",
    "total_messages": 4
  },
  "conversation": [
    {"role": "user", "content": "こんにちは"},
    {"role": "assistant", "content": "こんにちは！ご質問をどうぞ。\n\n- サンプル\n- リスト"},
    ...
  ]
}
```

## セットアップ

1. 必要な依存関係をインストール:
```bash
pip install -r requirements.txt
```

2. `.env`ファイルを作成し、Anthropic APIキーを設定:
```
ANTHROPIC_API_KEY=your_actual_api_key_here
```

3. アプリケーションを実行:

**シンプル版:**
```bash
python claude_tk_app_simple.py
```

**画像対応版:**
```bash
python claude_tk_app_image.py
```

**会話履歴・マルチターン版:**
```bash
python claude_tk_app_multi.py
```

## 使用方法

### シンプル版
1. アプリケーションを起動
2. 左側の質問欄に質問を入力
3. 「質問を送信する」ボタンをクリック
4. 右側の回答欄にClaudeからの回答が表示されます
5. 「新しい質問をする」ボタンで新しい質問を開始
6. 「終了する」ボタンでアプリケーションを終了

### 画像対応版
1. アプリケーションを起動
2. 「画像を選択」ボタンで画像を選択（オプション）
3. 左側の質問欄に質問を入力
4. 「質問を送信する」ボタンをクリック
5. 右側の回答欄にClaudeからの回答が表示されます
6. 「新しい質問をする」ボタンで新しい質問を開始（画像もリセット）
7. 「終了する」ボタンでアプリケーションを終了

### 会話履歴・マルチターン版
1. アプリケーションを起動
2. 左側の「新しい質問」欄に質問を入力
3. 「質問を送信する」ボタンまたはCtrl+Enterで送信
4. 右側の会話履歴欄に【質問 n】【回答 n】のペアで履歴が追加されます
5. 左下の「最新の回答」欄にも直近の回答が表示されます
6. 「会話をクリア」ボタンで履歴・入力欄・最新回答欄をリセット
7. 「終了する」ボタンでアプリケーションを終了

## Markdown変換機能

アプリケーションは以下のmarkdown要素を自動的にプレーンテキストに変換します：

- **見出し**: `# タイトル` → `タイトル`
- **太字**: `**太字**` → `太字`
- **斜体**: `*斜体*` → `斜体`
- **コードブロック**: ```` ```code``` ` → `code`
- **インラインコード**: `` `code` `` → `code`
- **リスト**: `- 項目` や `* 項目` → `・項目`
- **リンク**: `[テキスト](URL)` → `テキスト`
- **段落**: 適切な改行で区切られたテキスト

## 使用モデル

- **シンプル版**: claude-sonnet-4-20250514
- **画像対応版**: claude-sonnet-4-20250514
- **会話履歴・マルチターン版**: claude-sonnet-4-20250514

## 注意事項

- Anthropic APIキーが必要です
- インターネット接続が必要です
- シンプル版・画像対応版は質問1回につき回答1回の形式です
- 会話履歴・マルチターン版は過去の会話文脈を維持します
- Anthropic公式Pythonライブラリを使用
- Markdown変換には`markdown`ライブラリを使用
- 画像対応版には`Pillow`ライブラリが必要 